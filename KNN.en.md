# Interaction with K.N.N

**K.N.N** is a program for working with battery controllers, available via its [Telegram channel](https://t.me/+6p3V3i4zg4Q3NTNi) where you can download it and join discussions.

The visualization application expects an `XLS` format file from **K.N.N**.
The visualization program is flexible enough to display whatever columns are present in the `XLS` file.
If a flag remains unchanged in the dataset, its display can be toggled off through the checkbox dialog - Column Settings.

The file contains the following data types:
- Date and time
- Numerical data for charting
- Percentage data
- Controller state flags
- Process flags (charge/discharge)

## Date and Time
The first column contains date and time in `YYYY-MM-DD HH:MM:SS` format.
The column name may be absent.

## Numerical Data for Charting
Cell format - standard numerical.
For the `bq20z45` controller, these columns should be present:

|     |
|-----|
| (08) Temperature |
| (09) Voltage |
| (0A) Current |
| (0F) Remaining Capacity | 
| (10) Full Charge Capacity | 
| (14) Charging Current | 

## Percentage Data
Cell format - standard numerical. Column names contain `%` sign.
For the `bq20z45` controller:

|                                 |
|---------------------------------|
| (0C) Max Error %                |
| (0D) Relative State Of Charge % | 
| (0E) Absolute State Of Charge % | 
| WEAR %                        | 

## Controller and Battery State Flags
Cells in these columns use `BOOLEAN` format with `TRUE/FALSE` values.
For the `bq20z45` controller:

### SBS Data (Batt Info tab):
|     |
|-----|
| OCA |
| TCA |
| OTA |
| TDA |
| RCA |
| RTA |
| INIT |
| DSG |
| FC |
| FD |

### Specific Flags (BQ20Zxx tab):
|     |
|-----|
| FET0 |
| FET1 |
| XDSG |
| CHG |
| DSG |
And other significant flags.

### Extended Flags (Full Access):
|     |
|-----|
| CUV |
| COV |
| PF |
And other significant flags.

## Process Flags
Column names are prefixed with `F-`.
Process refers to charge/discharge cycles.
Columns are named `F-CHARGE` and `F-DISCHARGE`.
Cell format - standard numerical. Values limited to `0/1`.

## Polling Frequency and Data Sampling

### Maximum Frequency
Maximum polling frequency is essentially the time needed to read all parameters from the controller and write them to file without pauses between cycles. To increase sampling rate, you can reduce the amount of monitored data. However, for long-term training with 5- and 2-hour intervals, high data sampling isn't necessary.

### Optimal Sampling
The optimal approach would be continuous controller reading without pauses between cycles, while file recording would be more discrete and "smart". For example: writing data snapshots when any flag changes state and every `n` seconds (where `n` could start from 10).

## Short Data Table Example
A brief example of the data table:

|                     | (08) Temperature | (09) Voltage | (0A) Current | WEAR % | (0E) ASOC % | FC     | FD      | F-CHARGE | F-DISCHARGE |      
|---------------------|------------------|--------------|--------------|--------|-------------|--------|---------|----------|-------------|
| 2024-09-16 10:00:00 | 18.3             | 10500        | -2150        | 0      | 95          | TRUE   | FALSE   | 0        | 1           |
| 2024-09-16 11:00:00 | 19.2             | 10600        | -2160        | 2      | 93          | FALSE  | TRUE    | 0        | 1           |
| 2024-09-16 12:00:00 | 20.1             | 10750        | 2140         | 5      | 92          | FALSE  | TRUE    | 1        | 0           |
| 2024-09-16 13:00:00 | 21.0             | 10890        | 2100         | 7      | 91          | TRUE   | FALSE   | 1        | 0           |

## Expectations vs Reality
This document describes expectations. Actual data in the XLS file generated by KNN may differ and depends on the implementation by the program's KNN author.