# Взаимодействие с K.N.N

**K.N.N** - программа для работы с контроллерами батарей со своим [каналом в Telegram](https://t.me/+6p3V3i4zg4Q3NTNi), где её можно скачать и обсудить.

Приложение визуализации ожидает от **K.N.N** файл в формате `XLS`.
Программа визуализации достаточно гибкая, она визуализирует те столбцы, которые присутствуют в файле `XLS`.
Если в датасете флаг не меняется, то его отображение можно отключить через диалог с галочкой - Column Settings.

Файл содержит следующие виды данных:
 - дата и время
 - численные данные для построения графиков
 - процентные данные
 - флаги состояния контроллера
 - флаги процесса (заряд/разряд)

## Дата и время
Первый столбец содержит дату и время в формате `2024-09-16 10:00:00`
Название столбца может отсутствовать.

## Численные данные для построения графиков
Формат ячеек - стандартный числовой. 
Применительно к контроллеру `bq20z45` должны быть следующие поля (названия столбцов):

|     |
|-----|
| (08) Temperature |
| (09) Voltage |
| (0A) Current |
| (0F) Remaining Capacity | 
| (10) Full Charge Capacity | 
| (14) Charging Current | 

## Процентные данные
Формат ячеек - стандартный числовой. В названии столбца присутствует знак `%`.
Применительно к контроллеру `bq20z45` должны быть следующие поля (названия столбцов):

|                                 |
|---------------------------------|
| (0C) Max Error %                |
| (0D) Relative State Of Charge % | 
| (0E) Absolute State Of Charge % | 
| WEAR %                        | 

## Флаги состояния контроллера и батареи
Ячейки в этих столбцах имеют формат `BOOLEAN` и принимают значения `ИСТИНА/ЛОЖЬ`.
Применительно к контроллеру `bq20z45` должны быть следующие поля. 

### Данные SBS (вкладка Batt Info):
|     |
|-----|
| OCA |
| TCA |
| OTA |
| TDA |
| RCA |
| RTA |
| INIT |
| DSG |
| FC |
| FD |

### Специфические флаги (вкладка BQ20Zxx):
|     |
|-----|
| FET0 |
| FET1 |
| XDSG |
| CHG |
| DSG |
И остальные значимые.

### Расширенные флаги (Full Access):
|     |
|-----|
| CUV |
| COV |
| PF |
И остальные значимые.

## Флаг Процесса
Названия столбцов формируются добавлением префикса `F-`.
Под процессом понимается процесс заряд/разряд.
Такие столбцы называются соответственно `F-CHARGE` и `F-DISCHARGE`.
Формат ячеек - стандартный числовой. Значения в ячейках - только `0/1`. 

## Частота опроса, дискретизация данных

### Максимальная частота
Максимальной частотой опроса можно считать необходимое время для чтения всех параметров из контроллера и записи их в файл без пауз между циклами. Таким образом, для увелечения частоты дискретизации можно уменьшать количество данных, выделенных для мониторинга. Однако, в контексте обучения в длительном периоде с паузами по 5 и 2 часов нет необходимости в высокой частоте дискретизации данных.

### Оптимальная
Оптимальным будет вариант, если чтение контроллера будет происходить постоянно, без пауз между циклами, а занесение данных в файл будет более дискретным и "умным". Например: запись среза данных в файл происходит при смене состояния одного из флагов и каждые `n`-секунд. Где `n` может начинаться от 10-ти.

## Краткий пример таблицы с данными
Для сокращения приведён краткий пример таблицы данных.

|                     | (08) Temperature | (09) Voltage | (0A) Current | WEAR % | (0E) ASOC % | FC     | FD      | F-CHARGE | F-DISCHARGE |      
|---------------------|------------------|--------------|--------------|--------|-------------|--------|---------|----------|-------------|
| 2024-09-16 10:00:00 | 18.3             | 10500        | -2150        | 0      | 95          | ИСТИНА | ЛОЖЬ    | 0        | 1           |
| 2024-09-16 11:00:00 | 19.2             | 10600        | -2160        | 2      | 93          | ЛОЖЬ   | ИСТИНА  | 0        | 1           |
| 2024-09-16 12:00:00 | 20.1             | 10750        | 2140         | 5      | 92          | ЛОЖЬ   | ИСТИНА  | 1        | 0           |
| 2024-09-16 13:00:00 | 21.0             | 10890        | 2100         | 7      | 91          | ИСТИНА | ЛОЖЬ    | 1        | 0           |

## Ожидание и реальность
В этом документе изложены ожидания. Реальные данные, присутствующие в файле XLS, который генерирует программа KNN, могут отличаться и задаются реализацией автором программы KNN.